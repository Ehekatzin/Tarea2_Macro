---
title: "Pregunta_3"
author: "Ehekatzin García"
date: "22/2/2021"
output: pdf_document
header-includes:
   - \usepackage[nottoc]{tocbibind} \usepackage{graphicx} \usepackage{amsmath} \usepackage{fancyhdr} \pagestyle{fancy} \usepackage{enumitem} \usepackage[spanish]{babel} \usepackage{tablefootnote} \usepackage{threeparttablex} 
   - \renewcommand{\listfigurename}{Lista de figuras}
   - \renewcommand{\listtablename}{Lista de tablas}
bibliography: bibliografia.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
pacman::p_load(stargazer, equatiomatic)
```
               
## Problema 3: La $q$ de Tobin

Estudie la habilidad de modelo de la $q$ de Tobin para explicar las tasas de inversión de empresas individuales, siguiendo estos pasos:

\begin{enumerate}[label=(\alph*)]

\item Con el propósito de desarrollar intuición sobre la existencia y fuente de los datos corporativos, vaya al sitio de internet de algún corporativo mexicano y obtenga su reporte anual. De ahí, obtenga el valor de los activos menos los pasivos (excepto el capital) y construya el valor en libros de la empresa. Posteriormente, de dicho reporte, o del sitio de la BMV o de la BIVA, obtenga el valor de capitalización de mercado de la misma empresa y finalmente construya la variable ``Q'' como la razón de dichos valores.

\item Utilice su cuenta de GitHub.com para entrar al repositorio fisionmail, Colmex\_Macro\_2\_2021 y bajar el archivo de datos que está ahí, está en formato de stata,  ``.dta''. Cree una medida de inversión y una medida de q de Tobin: inversión puede ser el gasto en capital (capx) sobre el capital (ppen), o la tasa de cambio en el capital (\%$\Delta$ ppen), o la tasa de cambio de los activos (\%$\Delta$ta). 

\item Cree una medida de la q de Tobin: el  valor de mercado de la empresa sobre el valor en libros de la empresa, en donde el valor de mercado es es número de acciones por el precio de la acción.

\item Estime los coeficientes de una relación lineal entre la tasa de inversión en un periodo y la q de tobin en el mismo o en el periodo inmediato anterior. 

\item Produzca un estimado del coeficiente del costo de ajuste. 

\item Explique, suponiendo que la función de costo de ajuste es cuadrática (es decir $C_t=b(I_t/K_t)^2K_t $), qué implican los resultados de sus regresiones sobre el costo de ajuste relativo al capital total para una inversión de 30\% del capital total y qué implican los resultados para el tiempo que le tomaría a una empresa recorrer la mitad mitad del camino entre el capital que tiene, $K$, y el que quisiera tener $K^*$.

\item Simule una relación lineal $Y=a+bX+\epsilon$ y cree dos variables con error de medición $\tilde{X}=X+\tilde{\epsilon}$ and also $\tilde{\tilde{X}}=X-c{\epsilon}$. Luego estime tres relaciones lineales, la de $Y$ con $X$, la de $Y$ con $\tilde{X}$ y la de $Y$ con $\tilde{\tilde{X}}$, explicando los resultados que obtenga y relacionandolos con los hayazgos del inciso anterior.

\item Estime los coeficientes de una relación lineal entre la tasa de inversión en un periodo, la $q$ de Tobin en el mismo o en el periodo inmediato anterior, y el flujo de efectivo o las ganancias netas. Interprete los resultados contrastándolos con los resultados que obtuvo anteriormente.
\end{enumerate}

### Solución

### Inciso a)

Se decidió utilizar a Walmart México y Latinoaméria (WALMEX) como ejemplo para este ejercicio. El reporte anual se extrajo de su página oficial (https://www.walmex.mx/). Para este ejercicio se utilizará el [reporte anual del año 2019](https://informes.walmex.mx/2019/descargas/esp/Walmart_2019_informe_completo.pdf), ya que es el reporte disponible más reciente.


En el cuadro \ref{c_1} se muestran los activos de la empresa, así como los pasivos y el capital contable en millones de pesos. De dicha información se desprende que el total de activos de la empresa es de 349,173 mdp, mientras que los pasivos son 181,028 mdp.

\begin{table}[h!]
\centering
\caption{Información financiera de WALMEX: 2019}

\begin{tabular}{llllr}
\cline{1-2}

                                                                 & Millones de pesos \\ \hline
Efectivo y equivalentes de efectivo                              & 30,857            \\
Inventarios, neto                                                & 67,553            \\
Otros activos, neto                                              & 27,179            \\
Activo fijo, neto                                                & 188,439           \\
Crédito mercantil                                                & 35,145            \\ \hline
\textbf{Total de   activo}                                       & 349,173           \\ \hline
Proveedores                                                      & 87,116            \\
Otros   Pasivos                                                  & 93,912            \\
Capital   contable                                               & 168,145           \\ \hline
\textbf{Total   pasivo, capital contable y participación no controladora} & 349,173           \\ \hline
\end{tabular}
\begin{tablenotes}
\item[a] Fuente: Extraido del Reporte Anual enviado a la BMV de WALMEX.
\end{tablenotes}
\label{c_1}
\end{table}

El valor en libros de la empresa se construye mediante la sustracción de los activos y pasivos, de tal manera que el valor en libros de la empresa es de 168,145 mdp.

En el cuadro \ref{c_2} se muestra la información relativa a la cotización de las acciones de WALMEX, extraida de la Bolsa [Institucional de valores (BIVA)](https://www.biva.mx/empresas/emisoras_inscritas/emisoras_inscritas?instrumento=null&tipo_valor=null&sector=null&sub_sector=null&ramo=null&sub_ramo=null&emisora_id=1656&canceladas=false&biva=false&subTab=1&page=1).


\begin{table}
\resizebox{1\textwidth}{!}{\begin{minipage}{\textwidth}
\centering
\begin{threeparttable}[b] 
\caption{Información sobre la cotización de WALMEX en el mercado}
\begin{tabular}{lr}
\hline
Conceptos                & \multicolumn{1}{l}{} \\ \hline
Apertura                 & 59.61                     \\
Cierre   previo          & 59.68                     \\
Rango de   día           & 58.73 -- 60.18             \\
Rango a   52 días        & 47.76 -- 68.25             \\
Mercado                  & 1,042,097              \\
Relación   p/e           & 31.08                     \\
Volumen                  & 169,012.00                \\
Volumen   promedio       & 344.20                    \\
Precio/Valor   en libros & 9.69                      \\
Ev/EBITDA                & 75,386.91                 \\ \hline
\end{tabular}
\begin{tablenotes}
\item[a] Fuente: Extraido de BIVA.
\end{tablenotes}
\label{c_2}
\end{threeparttable}
\end{minipage}}
\end{table}

Para encontrar el valor de capitalización bursátil simplemente se multiplica el precio de cotización de las acciones por el número de éstas en el mercado. De esta forma, se obtiene que el valor de capitalización bursátil. Por lo tanto el valor de capitalización bursátil es de 1860.75 mdp. \footnote{Se utilizo el precio de cierre de 59.68 y un número de acciones de 31,178,721 , que fue extraido de la [BMV](https://www.bmv.com.mx/es/mercados/capitales).}

Teniendo en cuenta los datos obtenidos anteriormente, se procede a construir la \textit{Q} promedio mediante la siguiente fórmula:

\begin{equation}
Q=\frac{Valor \quad de\quad capitalización \quad bursátil}{Valor\quad en\quad libros\quad de\quad la\quad empresa}
\label{eq:1}
\end{equation}

De tal manera que la \textit{Q} para WALMEX en el año 2019 fue de aproximadamente 0.011. De esta manera, dado que la q toma un valor positivo que indicaría que la empresa estaría dispuesta a invertir, el valor se este coeficiente es relativamente bajo, lo que indicaría que el nivel de inversión que la empresa está dispuesta a realizar es relatvamente bajo.

### Inciso b)

Tanto para el caso particular de WALMEX, como  para el caso de la generación de la medida de inversión de la totalidad de las empresas solamente se utilizó la tasa de cambio del capital (Medida 1) y la tasa de cambio de los Activos (Medida 2) debido a que la información necesaria para la construcción de la medida de inversión representada por el cociente del gasto de capital y el total de capital era escasa para la mayor parte de las empresas. 

Para la construcción de las medidas de inversión de la totalidad de las empresas para el periodo 2007-2017 se decidió eliminar a las empresas cuya información no se encuentra disponible para la totalidad del periodo, así como la eliminación de las empresas que no contaban con la información suficiente para la construcción de alguna medida de inversión.

Las medidas de inversión de WALMEX y el promedio de las empresas registradas se pueden observar en la siguiente gráfica. Puede notarse que las medidas de inversión tienen diferencias en el nivel de volatilidad distintas. Sin embargo, parecen tener un  comportamiento relativamente similar a través del tiempo.


```{r b_promedio, echo=FALSE, include=FALSE}


# Se carga la base de datos
data <- readRDS("DATOS_CONTABLES_mas_Precio_Acciones.rds")

#Se le da un identificador único a cada empresa

#install.packages("pmdplyr")

library(pmdplyr)

data$id <- id_variable(data$Empresa, .method = "number", .minwidth = FALSE)

walmex <- data[(data$NombreCorto == "WALMART"),]

#Se crea una variable temporal

#Se eliminan las empresas que no se encuentren en todo el periodo

rep <- data%>%count(id, wt = NULL, sort = FALSE, name = NULL)

rep <- rep[(rep$n!=43),]

borrar <- c(unique(rep$id, incomparables = FALSE))

data <- data[!(data$id %in% borrar),] 

#Se reestablecen los identificadores

data$id <- id_variable(data$Empresa, .method = "number", .minwidth = FALSE)


n <- (1:56)

data$date <- NA

for (i in n) {
  
data$date[(data$id == i)] <- Fecha <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")

#data$date <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")

  
}


#Se crea la medida de inversión


# Medida 1

x <- c(2:43)

data$inv_1 <- NA

for (i in n) {
  for(j in x){

    data$inv_1[j+(i-1)*43][(data$id == n)] <- ((data$PPE[(j+ (i-1)*43)] / data$PPE[(j - 1)+(i-1)*43]) - 1 )
    
  }
}

data$inv_1[(data$Trimestre==2 & data$Anio ==2007)] <- NA


data$efe <- NA

for (i in n) {
  for(j in x){

    data$efe[j+(i-1)*43][(data$id == n)] <- ((data$Efectivo[(j+ (i-1)*43)] / data$Efectivo[(j - 1)+(i-1)*43]) - 1 )
    
  }
}

data$efe[(data$Trimestre==2 & data$Anio ==2007)] <- NA


# Medida 2

data$inv_2 <- NA


for (i in n) {
  for(j in x){

    data$inv_2[j+(i-1)*43][(data$id == n)] <- ((data$Activos[(j+ (i-1)*43)] / data$Activos[(j - 1)+(i-1)*43]) - 1 )
    
  }
}

data$inv_2[(data$Trimestre==2 & data$Anio ==2007)] <- NA


# Medida 3

data$inv_3 <- NA


for (i in n) {
  for(j in x){
    
    data$inv_3[j+(i-1)*43][(data$id == n)] <- ((data$GC[(j+ (i-1)*43)] / data$PPE[(j)+(i-1)*43]) - 1 )
    
  }
}


#Gráficas de la medida de inversión


g1 <- data.frame(cbind(data$id, data$inv_1, data$date, data$Trimestre))
names(g1) <- c("id","Medida", "Fecha", "q")
g1$Fecha <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")

#Se elimianan a las empresas con NA en su medida


nas <- g1[is.na(g1$Medida),]
nas <- nas[(nas$q != 2),]

borrar <- c(unique(nas$id, incomparables = FALSE))

g1 <- g1[!(g1$id %in% borrar),] 

h1 <- g1[!(g1$id %in% borrar),] 
 
g1 <- aggregate(g1, by = list(g1$Fecha), mean)



g2 <- data.frame(cbind(data$id, data$inv_2, data$date, data$Trimestre))
names(g2) <- c("id","Medida2", "Fecha", "q")
g2$Fecha <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")

#Se elimianan a las empresas con NA en su medida

nas <- g2[is.na(g2$Medida2),]
nas <- nas[(nas$q != 2),]

borrar <- c(unique(nas$id, incomparables = FALSE))

g2 <- g2[!(g2$id %in% borrar),] 

h2 <- g2[!(g1$id %in% borrar),] 
  
g2 <- aggregate(g2, by = list(g2$Fecha), mean)


g3 <- data.frame(cbind(data$id, data$inv_3, data$date, data$Trimestre))
names(g3) <- c("id","Medida3", "Fecha", "q")
g3$Fecha <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")


#Se elimianan a las empresas con NA en su medida

nas <- g3[is.na(g3$Medida3),]

borrar <- c(unique(nas$id, incomparables = FALSE))

g3 <- g3[!(g3$id %in% borrar),] 
  
#g3 <- aggregate(g3, by = list(g3$Fecha), mean)

#Para esta medida no hay nadie

inv_mean <- left_join(g1,g2, by=c("Fecha"), copy = FALSE)

#inv_mean <- left_join(inv_mean, g3, by = c("Fecha"), copy = FALSE)

incluir <- c("Fecha","Medida", "Medida2")

inv_mean <- inv_mean[ , (names(inv_mean) %in% incluir)]

names(inv_mean) <- c("Medida 1", "Fecha", "Medida 2")
library(reshape2)
plot1 <- melt(inv_mean, id.vars="Fecha")

#Se quita el primer dato

plot1 <- plot1[(plot1$Fecha != "2007-04-01"),]

library(ggplot2)

graph1_T <- ggplot(plot1, aes(x=Fecha, y=value, color = variable , shape = variable)) +
  geom_line(aes(linetype=variable))+
  geom_point()+
  theme_classic()+
  xlab("")+
  ylab("Medidas de Inversión")+
  scale_color_brewer(palette = "Set2")+
  theme_bw() 



```



```{r b_walmex, echo=FALSE, include=FALSE}

#walmex <- data[(data$NombreCorto == "WALMART"),]

walmex$date <- Fecha <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")


#Medida de inversión

n <- c(2:43)

walmex$inv1 <- 0

for (i in n) {
walmex$inv1[i] <- (( walmex$PPE[i] / walmex$PPE[i - 1] ) - 1 )
}


#for (i in n) {
#walmex$inv1[i] <- ( 1 - ( walmex$PPE[i - 1] / walmex$PPE[i]) )*100
#}

walmex$inv2 <- 0

for (i in n) {
walmex$inv2[i] <- (( walmex$Activos[i] / walmex$Activos[i - 1] ) - 1 )
}

inv_mean$`Medida 1` <- walmex$inv1
inv_mean$Fecha <- walmex$date
inv_mean$`Medida 2` <- walmex$inv2

plott <- melt(inv_mean, id.vars="Fecha")

#Se quita el primer dato

plott <- plott[(plott$Fecha != "2007-04-01"),]

grafo <- ggplot(plott, aes(x=Fecha, y=value, color = variable , shape = variable)) +
  geom_line(aes(linetype=variable))+
  geom_point()+
  theme_classic()+
  xlab("")+
  ylab("Medidas de Inversión")+
  scale_color_brewer(palette = "Set2")+
  theme_bw() 

```




```{r, echo=FALSE,fig.width = 10 ,message=FALSE, warning=FALSE, fig.cap="Medidas de inversión", position = "!H", label = "g1"}


library("gridExtra")

grid.arrange(grafo + ggtitle("WALMEX"), graph1_T+ ggtitle("Promedio"), 
             ncol = 1, nrow = 2)




```


### Inciso c)

Para la construcción de la q de Tobin utilizó la siguiente ecuación para cada una de las empresas:

\begin{equation}
q=\frac{Valor\quad de\quad mercado}{Activos-Deuda}
\end{equation}

En la siguiente gráfica se puede observar el comportamiento de la $q$ de Tobin durante el periodo de estudio. En el caso de el promedio de las empresas, puede notarse que la $q$ siguió una tendencia a la baja durante los primeros años del periodo, lo que puede deberse a la crisis financiera de 2008. Sin embargo, la tendencia cambió drasticamente a partir de 2009 donde la tendencia empezó a ser positiva.

Por su parte, la $q$ de Tobin de WALMEX presentó una tendencia a la baja durante los años 2007 y 2008 al igual que el promedio de la economía. Sin embargo, en contraste con la tendencia del promedio de las empresas, la q de Tobin de esta empresa se mantuvo estancada. Cabe destacar que este coeficiente es mucho menor al que se observa en el promedio de la economía.  

```{r c_promedio, echo=FALSE, include=FALSE}

#q de Tobin

#Valor de mercado

data$Valor_M <- data$mkt_capital

data$V_libros <- data$Activos - data$Deuda

data$q <- data$Valor_M/ data$V_libros

plot2 <- data.frame(cbind(data$q, data$date, data$id, data$efe))

names(plot2) <- c("q", "date", "id", "Efectivo")

nas <- plot2[is.na(plot2$q),]

borrar <- c(unique(nas$id, incomparables = FALSE))

plot2 <- plot2[!(plot2$id %in% borrar),] 

plot3 <- aggregate(plot2, by = list(plot2$date), mean)

plot3$date <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")


graph2_T <- ggplot(plot3, aes(x=date, y=q)) +
  geom_line(aes())+
  geom_point()+
  theme_classic()+
  xlab("")+
  ylab("q de Tobin")+
  scale_color_brewer(palette = "Set2")+
  theme_bw()+ 
  ggtitle("Promedio")

```

```{r c_WALMEX, echo=FALSE, include=FALSE}

#q de Tobin

#Valor de mercado

walmex$Valor_M <- walmex$mkt_capital
walmex$V_libros <- walmex$Activos - walmex$Deuda

walmex$q <- walmex$Valor_M/ walmex$V_libros

graph2 <- ggplot(walmex, aes(x=date, y=q)) +
  geom_line(aes())+
  geom_point()+
  theme_classic()+
  xlab("")+
  ylab("q de Tobin")+
  scale_color_brewer(palette = "Set2")+
  theme_bw()+
  ggtitle("WALMEX")

```



```{r  echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.cap="q de Tobin", position = "!H", label = "g2"}

library("gridExtra")

grid.arrange(graph2, graph2_T, 
             ncol = 1, nrow = 2)

```

\newpage

### Inciso d)

La relación entre la inversión y la q de Tobin fue estimada a través de una regresión lineal por \textit{Mínimos Cuadrados Ordinarios}. Por su parte, la relación para la totalidad de las empresas se realizó mediante una regresión de panel, utilizando efectos fijos y efectos aleatorios. 

La especificación utilizada es la propuesta por Summers[-@summers]\footnote{La especificación propuesta por Summers se desprende del supuesto de una función de costos de ajustes cuadrada en la inversión ($C(I(t),k(t))=\frac{1}{2}a[\frac{I(t)}{k(t)}]^2k(t)$), de tal manera que, utilizando la CPO del problema de maximización ($1-C'(I(t))= q(t)$), llega a que $1+a[\frac{I(t)}{k(t)}]=q(t)$, de tal manera que despejando q se llega a la especificación propuesta, en donde $b=1/a$.} :

\begin{equation}
\frac{I_t}{K_t} = c + b[q_t -1]+\epsilon_t
\end{equation}


Adicionalmente, se realizaron regresiones con la $q$ de Tobin rezagada un periodo, de tal manera que la especificación utilizada para dichas regresiones fue:

\begin{equation}
\frac{I_t}{K_t} = c + b[q_{t-1} -1]+\epsilon_t
\end{equation}


A continuación se muestran los resultados de dichas regresiones.

```{r include=FALSE}

library(dplyr)
library(tidyverse)

h1 <- h1[, !(names(h1)=="q")]

names(h1) = c("id", "inv_1", "date")

plot2$date <- seq(as.Date("2007/4/1"), as.Date("2017/12/31"), by = "quarter")

data_1 <- left_join(plot2, h1, by=c("date", "id"), copy = FALSE)

data_1 <- data_1 %>% drop_na(inv_1)

library(Hmisc)
library(plm)

data_1$x <- data_1$q -1

data_1$q2 <-  Lag(data_1$x, -1)

mod1 <- plm(inv_1 ~ x, data = data_1, index = c("id","date"), model="within", effect="individual")
mod2 <- plm(inv_1 ~ q2, data = data_1, index = c("id","date"), model="within", effect="individual")


h2 <- h2[, !(names(h2)=="q")]

names(h2) = c("id", "inv_2", "date")


data_2 <- left_join(plot2, h2, by=c("date", "id"), copy = FALSE)

data_2 <- data_2 %>% drop_na(inv_2)

data_2$x <- data_2$q -1

data_2$q2 <-  Lag(data_2$x, -1)


mod3 <- plm(inv_2 ~ x, data = data_2, index = c("id","date"), model="within", effect="individual")
mod4 <- plm(inv_2 ~ q2, data = data_2, index = c("id","date"), model="within", effect="individual")


names(inv_mean) = c("inv_1", "date", "inv_2")

data2 <- left_join(plot3, inv_mean, by=c("date"), copy = FALSE)

data2 <- data2[(data2$date != "2007-04-01"),]

mod5 <- lm(inv_1 ~ q, data = data2)
mod6 <- lm(inv_2 ~ q, data = data2)


data2$q2 <-  Lag(data2$q, -1)

mod7 <- lm(inv_1 ~ q2, data = data2)
mod8 <- lm(inv_2 ~ q2, data = data2)

mod1_R <- plm(inv_1 ~ x, data = data_1, index = c("id","date"), model="random", effect="individual")
mod2_R <- plm(inv_1 ~ q2, data = data_1, index = c("id","date"), model="random", effect="individual")

mod3_R <- plm(inv_2 ~ x, data = data_2, index = c("id","date"), model="random", effect="individual")
mod4_R <- plm(inv_2 ~ q2, data = data_2, index = c("id","date"), model="random", effect="individual")


phtest(mod1, mod1_R)
phtest(mod2, mod2_R)
phtest(mod3, mod3_R)
phtest(mod4, mod4_R)

```
  
```{r , results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}

stargazer(mod1, mod2, mod3, mod4, 
          style="aer",
          title= "Inversión - q de Tobin (Fixed-effects) ",
          header = FALSE,
          #column.labels=c("Medida 1", "Medida 1", "Medida 2", "Medida 2"), 
          dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Medida 1", "Medida 2", "Promedio 1", "Promedio 2"),
          covariate.labels =  c("(q-1)", "($q_{t-1}$-1)", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!h")
```

```{r , results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}

stargazer(mod1_R, mod2_R, mod3_R, mod4_R, 
          style="aer",
          title= "Inversión - q de Tobin (Random-effects) ",
          header = FALSE,
          #column.labels=c("Medida 1", "Medida 1", "Medida 2", "Medida 2"), 
          dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Medida 1", "Medida 2", "Promedio 1", "Promedio 2"),
          covariate.labels =  c("(q-1)", "($q_{t-1}-1$)", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!h")
```


```{r include=FALSE}

walmex$x <- (walmex$q - 1)

walmex$q2 <-  Lag(walmex$x, -1)

walmex <- walmex[(walmex$date != "2017-10-01"),]

```


```{r include=FALSE}

reg1 <- lm(inv1 ~ x,  data  = walmex)
reg2 <- lm(inv1 ~ q2, data  = walmex)
reg3 <- lm(inv2 ~ x,  data  = walmex)
reg4 <- lm(inv2 ~ q2, data  = walmex)

```

```{r eval=FALSE, include=FALSE}
#extract_eq(reg1, use_coefs = TRUE)
```



```{r , results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}

stargazer(reg1, reg2, reg3, reg4, 
          style="aer",
          title= "Inversión - q de Tobin (WALMEX)",
          header = FALSE,
          #column.labels=c("Medida 1", "Medida 1", "Medida 2", "Medida 2"), 
          dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Medida 1", "Medida 2", "Promedio 1", "Promedio 2"),
          covariate.labels =  c("q", "$q_{t-1}$", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!h")
```


En el caso de las regresiones para la totalidad de las empresas se encuentra que la regresión más adecuada es la regresión de panel con efectos aleatorios \footnote{Se llegó a dicha conclusión utilizando la prueva de Hausman.}. Se encuentra que los coeficientes asociados al término $(q-1)$ y $(q_{t-1}-1)$ son significativos, tanto para la medida 1 como para la medida 2. También se encuentra que el estadístico $F$ es significativo para todos los modelos. No obstante, el valor $R^2$ es muy bajo en todos los casos, por lo que es probable que las variables independientes no sean las adecuadas para explicar la inversión.

Para el caso de WALMEX, no se encontró ningún modelo en el que los coeficientes asociados a la q de Tobin, del periodo o rezagada, fueran estadísticamente significativos, es decir, no se encuentra que exista una relación entre la inversión y la q de Tobin de la empresa. A pesar de ello, se utilizarán los resultados en los siguientes ejemplos a modo ilustrativo.

\newpage
\newpage

### Inciso e)

Utilizando la ecuación $C(I(t),k(t))=\frac{1}{2}a[\frac{I(t)}{k(t)}]^2k(t)$, y recordando que $b=1/a$, es posible encontrar el coeficiente del costo de ajuste. En la siguiente tabla se muestran los coeficientes del costo de ajuste.


\begin{table}[h]
\centering
\caption{Coeficientes de costo de ajuste}
\begin{tabular}{lllll}
\hline
       & \multicolumn{2}{c}{Medida 1} & \multicolumn{2}{c}{Medida 2} \\
       & $q_t$       & $q_{t-1}$      & $q_t$  & $q_{t-1}$           \\ \hline
Total  & 40.00       & 43.48          & 200.00 & 250.00              \\
WALMEX & 3.32        & 3.42           & 23.81  & -              8.40 \\ \hline
\end{tabular}
\label{costos}
\end{table}

Como puede notarse, el coeficiente asociado a los costos en el caso de la totalidad de las empresas es mucho más consistente (por el presentado por Summers) en el caso de la Medida 1 que en el caso de la Medida 2, lo que podría indicar que la Medida 1 es la más indicada para medir la inversión. Por su parte, el coeficiente de costo de ajuste asociado a WALMEX, es muy alto en el caso de la Medida 1, mientras que en la medida 2 se encuentra un coeficiente negativo. Lo anterior parece ser resultado de que los coeficientes encontrados en laregresión no son estadísticamente significativos.


\newpage

### Inciso f)

Suponiendo que el costo de ajuste es $C_t=b(I_t/K_t)^2K_t$, derivando y sustituyendo en la CPO se obtiene:



$$1+C'(I(t)) = q_t$$
$$ 2b(\frac{I(t)}{k(t)}=q_t-1$$
$$\frac{I(t)}{k(t)}=\beta(q_t-1), \quad con \quad \beta = \frac{1}{2b} \Longrightarrow b=\frac{1}{2\beta} $$
Por lo que la función de costos se puede escribir como:

\begin{equation}
C_t=\frac{1}{2\beta}(I_t/K_t)^2K_t
\end{equation}

El resultado se muestra en el siguiente cuadro:

\begin{table}[!h]
\centering
\caption{Costo de ajuste sobre el capital}
\begin{tabular}{lllll}
\hline
       & \multicolumn{2}{c}{Medida 1} & \multicolumn{2}{c}{Medida 2} \\
       & $q_t$       & $q_{t-1}$      & $q_t$  & $q_{t-1}$           \\ \hline
Total  & 1.80        & 1.96           & 9.00   & 11.25               \\
WALMEX & 0.15        & 0.15           & 1.07   & -              0.38 \\ \hline
\end{tabular}
\end{table}

Como puede verse, en el caso de todas las empresas, el costo de ajuste es mayor, estando en la mayoría de los casos por encima del 100\%. Por su parte, el costo de ajuste como porcentaje del total del capital para Walmart se encuentra en el 15\% para la Medida 1. 



\newpage


### Inciso g)

```{r echo=FALSE}
set.seed(123)
```

```{r include=FALSE}
X <- runif(n = 43, min = 0, max = 50)
e1 <- rnorm( n= 43, mean = 0, sd = 1.5)
e2 <- rnorm( n= 43, mean = 0, sd = 1.5)
a <- c(rep(7,43))
Y = a + 4*X + e1
Xb = X + e2
Xbb = X - 3*e1
```

```{r include=FALSE}
regYX <- lm(Y ~ X)
regYXb <- lm(Y ~ Xb)
regYXbb <- lm(Y ~ Xbb)
```

Se simula la relación $Y = 7 + 4X + e_1$ usando un vector aleatorio uniformemente distribuido para los valores de la X y un vector aleatorio distribuido normal con media 0 y varianza 2.25 para el error.

Se crean dos variables con error de medicion $X_b = X + e_2$ usando un vector aleatorio normal con media 0 y varianza 2.25 para $e_2$

En la siguiente tabla se muestra la regresión de Y con X, Y con $X_b$ y Y con $X_{bb}$.



```{r regresionYXbbb, results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}
stargazer(regYX, regYXb, regYXbb,
          style="aer",
          title= "Regresión",
          header = FALSE,
          #dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Y"),
          covariate.labels =  c("X", "Xb", "Xbb", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!htbp")
```
Como puede observarse, tanto los coeficientes como el ajuste del modelo cambia según la utilización de las medidas de error. Lo anterior responde a ciertas limitaciones en la estimación de $Y$ con respecto a $X$, ya que, en escencia, no se conocen las fuentes que originan las variaciones en la variable independiente o las fuentes que originan la existencia del error. Dicha falta de información en el modelo hace imposible saber si la variable independente y el error se encuentran correlacionados y que el coeficiente asociado a la variable independiente esté sesgado. La estimación de dos variables de medición y añadirlas a la regresión original permite reducir el sesgo del estimador, por lo que los coeficientes asociados a la variable X en las regresiones (2) y (3), en teoría, deben tener un menor sesgo al estimador presentado en la regresión (1) [@romer].

Lo anterior se relaciona con las estimaciones realizadas y los estimadores asociados a la $q$ de tobin en el sentido de que, al ser la $q$ una variable que contiene toda la información relevante para la elección respecto a los niveles de inversión, es posible que los factores que originan variaciones en la $q$  se hayan omitido en la estimación. Lo anterior puede ser la razón de el poco ajuste de los modelos. De esta manera, a la estimación de los niveles de inversión con respecto a la $q$ de Tobin se le han agregado variables explicativas resumidas en la $q$ (producción, ventas, medidas de fondos internos, etc.) que generalmente tienen asociados estimadores estadísticamente significativos, principalmente el flujo de efectivo. Sin embargo, puede que la inclusión de dichas variables sean solamente "artefactos de error de medición" [@erickson].




\newpage

### Inciso h)

Se añada el flujo de efectivo (medido como la variación del efectivo de la empresa respecto al periodo inmediato anterior) a las regresiones propuestas anteriormente, tal que:

\begin{equation}
\frac{I_t}{K_t} = c + b[q_t -1]+\gamma Efectivo \epsilon_t
\end{equation}

Al igual que las regresiones anteriores, se realizó el ejercicio para la empresas WALMEX y para la totalidad de las empresas, utilizando como variables dependientes la Medida 1 y la Medida 2 para la inversión y tomando como variables independientes la $q$ de Tobin del periodo y la de el periodo anterior.


```{r include=FALSE}


mod1_R <- plm(inv_1 ~ x + Efectivo, data = data_1, index = c("id","date"), model="random", effect="individual")
mod2_R <- plm(inv_1 ~ q2 +Efectivo, data = data_1, index = c("id","date"), model="random", effect="individual")
mod3_R <- plm(inv_2 ~ x +Efectivo, data = data_2, index = c("id","date"), model="random", effect="individual")
mod4_R <- plm(inv_2 ~ q2 +Efectivo, data = data_2, index = c("id","date"), model="random", effect="individual")




```



```{r include=FALSE}
regmulti1 <- lm(inv1 ~ x + Efectivo, data = walmex)
regmulti2 <- lm(inv1 ~ q2 + Efectivo, data = walmex)
regmulti3 <- lm(inv2 ~ x + Efectivo, data = walmex)
regmulti4 <- lm(inv2 ~ q2 + Efectivo, data = walmex)
```


```{r , results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}

stargazer(regmulti1, regmulti2, regmulti3, regmulti4, 
          style="aer",
          title= "Inversión - q de Tobin (WALMEX)",
          header = FALSE,
          #column.labels=c("Medida 1", "Medida 1", "Medida 2", "Medida 2"), 
          dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Medida 1", "Medida 2", "Promedio 1", "Promedio 2"),
          covariate.labels =  c("(q-1)", "$(q_{t-1}-1)$", "Efectivo", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!h")
```

```{r , results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}

stargazer(mod1_R, mod2_R, mod3_R, mod4_R, 
          style="aer",
          title= "Inversión - q de Tobin (Random-effects) ",
          header = FALSE,
          #column.labels=c("Medida 1", "Medida 1", "Medida 2", "Medida 2"), 
          dep.var.caption = "Variable Dependiente",
          dep.var.labels = c("Medida 1", "Medida 2", "Promedio 1", "Promedio 2"),
          covariate.labels =  c("(q-1)", "($q_{t-1}-1$)", "Efectivo", "Intercepto"),
          notes.label = "P-valor",
          type="latex",
          table.placement = "!h")
```

Como puede verse, para el caso de la totalidad de las empresas, el estimador asociado al flujo de efectivo resulta no ser estadísticamente significativo para el caso de la Medida 1 de la inversión, de tal manera que el ajuste general del modelo, medido por la $R^2$ no es distinto respecto a la primer estimación. En lo que respecta a las estimaciones para la Medida 2 de la inversión, se encuentra que el estimador asociado al flujo de efectivo es estadísticamente significativo, aunque cercano a cero, lo que provoca una ligera variación de los estimadores asociados a la $q$ de Tobin en ambos casos. Además, es evidente que la $R^2$ de estos modelos es superior a los primeros modelos, lo que indica que añadir al flujo de efectivo como variable explicativa aumenta el ajuste general del modelo, lo que puede implicar que se eliminó el sesgo de los estimadores asociados a las $q$.

En el caso de WALMEX, se encuentra que ningún estimador es estadísticamente significativo, lo que indica que la adición de una nueva variable explicativa no reduce el sesgo del estimador asociado a la $q$ de Tobin.

\newpage

